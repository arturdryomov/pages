<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8"/>

  <title>Kotlin Enum Recipes</title>
  <meta name="description" content="Is this... a sealed class?"/>
  <meta name="author" content="Artur Dryomov"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="stylesheet" href="/css/syntax-highlighting.css"/>

  
  <meta name="theme-color" content="#1e2327">

  </head>

<body>

<header>
<nav>
  <ul>
    
    <li class="menu-left"><a href="/">Posts</a></li>
    
    
    <li class="menu-right"><a href="feed://arturdryomov.dev/index.xml">RSS</a></li>
    
    <li class="menu-right"><a href="https://github.com/arturdryomov">GitHub</a></li>
    
  </ul>
</nav>

</header>

<br/>


<div class="meta">

  <h1><span class="title">Kotlin Enum Recipes</span></h1>
  <h3>October 8, 2019</h3>

</div>

<main>
<p>Enumerations, in a form of <code>enum class</code> declarations, got a bad rep on Android.
In fact, the official documentation straight out
<a href="https://developer.android.com/topic/performance/reduce-apk-size#remove-enums">recommends to avoid them</a>.
How rude is that?
At the same time, <a href="https://www.amazon.com//dp/0134685997">Effective Java</a>
has a full chapter about <code>enum</code>.
The situation reminds me of <a href="https://en.wikipedia.org/wiki/Trolley_problem">the trolley problem</a>.
Kind of.</p>
<p>In this article, I’ll distance myself from Android specifics and show
useful <code>enum</code>-related snippets.</p>
<h1 id="declaration">Declaration</h1>
<h2 id="naming">Naming</h2>
<p>Use <code>CamelCase</code>, don’t be ashamed. I doubt that anyone names
<code>sealed class</code> using the <code>UPPERCASE</code> notation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">class</span> <span class="nc">Level</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">data</span> <span class="k">class</span> <span class="nc">HIGH</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">Long</span><span class="p">)</span> <span class="p">:</span> <span class="n">Level</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">data</span> <span class="k">class</span> <span class="nc">LOW</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">Short</span><span class="p">)</span> <span class="p">:</span> <span class="n">Level</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Enumerations are not so different. Don’t scream in code!
We don’t have <a href="https://en.wikipedia.org/wiki/BASIC">BASIC</a> syntax constraints.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Fruit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Apple</span><span class="p">,</span> <span class="n">Orange</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="commas">Commas</h2>
<p>Let’s say we have a <code>Screen</code> enumeration.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Screen</span><span class="p">(</span><span class="k">val</span> <span class="py">analyticsName</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">SignIn</span><span class="p">(</span><span class="s2">&#34;Sign In&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>At some point we need to add another case to the <code>Screen</code> — <code>SignUp</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Screen</span><span class="p">(</span><span class="k">val</span> <span class="py">analyticsName</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">SignIn</span><span class="p">(</span><span class="s2">&#34;Sign In&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">SignUp</span><span class="p">(</span><span class="s2">&#34;Sign Up&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Looks fine, but the change from a VCS perspective will be like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">- SignIn(&#34;Sign In&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ SignIn(&#34;Sign In&#34;),
</span></span></span><span class="line"><span class="cl"><span class="gi">+ SignUp(&#34;Sign Up&#34;)
</span></span></span></code></pre></div><p>This approach makes it difficult to see through <code>SignIn</code> changes.
The last <code>SignIn</code> change is now tied to the <code>SignUp</code> one which doesn’t make sense.
We can solve this by putting commas after each enumeration case.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Screen</span><span class="p">(</span><span class="k">val</span> <span class="py">analyticsName</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">SignIn</span><span class="p">(</span><span class="s2">&#34;Sign In&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">SignUp</span><span class="p">(</span><span class="s2">&#34;Sign Up&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This way the VCS change becomes minimal.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gi">+ SignUp(&#34;Sign Up&#34;),
</span></span></span></code></pre></div><h1 id="usage">Usage</h1>
<h2 id="constants-namespacing">Constants Namespacing</h2>
<p>The barbarian approach to create namespaces is using prefixes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">val</span> <span class="py">SHARED</span><span class="n">_PREFERENCE_KEY_TOKEN</span> <span class="p">=</span> <span class="s2">&#34;token&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">val</span> <span class="py">SHARED</span><span class="n">_PREFERENCE_KEY_SESSIONS_COUNT</span> <span class="p">=</span> <span class="s2">&#34;sessions-count&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The next step — named <code>companion object</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">companion</span> <span class="k">object</span> <span class="n">SharedPreferenceKeys</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">val</span> <span class="py">TOKEN</span> <span class="p">=</span> <span class="s2">&#34;token&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">val</span> <span class="py">SESSIONS</span><span class="n">_COUNT</span> <span class="p">=</span> <span class="s2">&#34;sessions-count&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>There is catch though — a class can have a single <code>companion object</code>, named or not.
<code>enum</code> doesn’t have such limitations.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">SharedPreferenceKey</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Token</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">SessionsCount</span><span class="p">(</span><span class="s2">&#34;sessions-count&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="abstraction">Abstraction</h2>
<h3 id="api">API</h3>
<p>Let’s imagine that a backend returns codes in error responses.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorResponse</span><span class="p">(</span><span class="nd">@SerializedName</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span> <span class="k">val</span> <span class="py">code</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span></span></code></pre></div><p>This is a fine declaration but the usage becomes repetitive and error-prone to typos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&#34;not_found&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="n">RuntimeException</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ... 1_000_000 LOC ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Oops!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&#34;not__found&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="n">RuntimeException</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Enumerations are perfect for this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">ErrorCode</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s2">&#34;not_found&#34;</span><span class="p">)</span> <span class="n">NotFound</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SerializedName</span><span class="p">(</span><span class="s2">&#34;unauthorized&#34;</span><span class="p">)</span> <span class="n">Unauthorized</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorResponse</span><span class="p">(</span><span class="nd">@SerializedName</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span> <span class="k">val</span> <span class="py">code</span><span class="p">:</span> <span class="n">ErrorCode</span><span class="p">?)</span>
</span></span></code></pre></div><blockquote>
<p>&#x26a0;&#xfe0f; Gson will write unknown <code>enum</code> values as <code>null</code> —
ignoring the Kotlin nullability — since the Java reflection doesn’t know about Kotlin.
Make such values nullable and handle them as deserialization errors or use
Moshi which will do it automatically.</p></blockquote>
<h3 id="android-resources">Android Resources</h3>
<p>It is possible to define <code>enum</code> in XML which is helpful with custom <code>View</code> implementations.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">&#34;NavigationBar&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">&#34;navigationIcon&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;enum</span> <span class="na">name=</span><span class="s">&#34;back&#34;</span> <span class="na">value=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;enum</span> <span class="na">name=</span><span class="s">&#34;close&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;enum</span> <span class="na">name=</span><span class="s">&#34;menu&#34;</span> <span class="na">value=</span><span class="s">&#34;2&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/attr&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/declare-styleable&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;NavigationBar</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">application:navigationIcon=</span><span class="s">&#34;close&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><p>Instead of <code>Int</code>-matching in <code>NavigationBar.kt</code> it is better
to declare an <code>enum</code> as a direct XML mirror.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">NavigationIcon</span><span class="p">(</span><span class="k">val</span> <span class="py">attrValue</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Back</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Close</span><span class="p">(</span><span class="m">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Menu</span><span class="p">(</span><span class="m">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">defaultIcon</span> <span class="p">=</span> <span class="nc">NavigationIcon</span><span class="p">.</span><span class="n">Back</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="py">icon</span> <span class="p">=</span> <span class="n">attrs</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">styleable</span><span class="p">.</span><span class="n">NavigationBar_navigationIcon</span><span class="p">,</span> <span class="n">defaultIcon</span><span class="p">.</span><span class="n">attrValue</span><span class="p">).</span><span class="n">let</span> <span class="p">{</span> <span class="n">attrValue</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nc">NavigationIcon</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">find</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">attrValue</span> <span class="o">==</span> <span class="n">attrValue</span> <span class="p">}</span> <span class="o">?:</span> <span class="n">defaultIcon</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="even-more">Even More</h3>
<p>Map markers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Marker</span><span class="p">(</span><span class="nd">@DrawableRes</span> <span class="k">val</span> <span class="py">icon</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="k">val</span> <span class="py">elevation</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Airport</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_map_airport</span><span class="p">,</span> <span class="n">elevation</span> <span class="p">=</span> <span class="m">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Underground</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_map_underground</span><span class="p">,</span> <span class="n">elevation</span> <span class="p">=</span> <span class="m">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">ViewState</span><span class="p">(</span><span class="k">val</span> <span class="py">marker</span><span class="p">:</span> <span class="n">Marker</span><span class="p">,</span> <span class="k">val</span> <span class="py">location</span><span class="p">:</span> <span class="n">LatLng</span><span class="p">)</span>
</span></span></code></pre></div><p>List sections:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="nd">@StringRes</span> <span class="k">val</span> <span class="py">title</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="k">val</span> <span class="py">from</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="k">val</span> <span class="py">to</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Dozen</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">Section_Dozen</span><span class="p">,</span> <span class="n">from</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">to</span> <span class="p">=</span> <span class="m">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Dozens</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">Section_Dozens</span><span class="p">,</span> <span class="n">from</span> <span class="p">=</span> <span class="m">11</span><span class="p">,</span> <span class="n">to</span> <span class="p">=</span> <span class="nc">Int</span><span class="p">.</span><span class="n">MAX_VALUE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">listOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">42</span><span class="p">).</span><span class="n">groupBy</span> <span class="p">{</span> <span class="n">number</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Section</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">find</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">from</span> <span class="o">&lt;=</span> <span class="n">number</span> <span class="o">&amp;&amp;</span> <span class="n">number</span> <span class="o">&lt;=</span> <span class="k">it</span><span class="p">.</span><span class="n">to</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The idea remains the same — use the declarative <code>enum</code> nature when it fits.</p>
<h2 id="iterating">Iterating</h2>
<h3 id="templates">Templates</h3>
<p>Let’s say we need to render an HTML page. Since we want to keep application colors
and HTML colors in sync, we need to translate resources to RGBA hex values.</p>
<p>This is where the <code>enum</code> <code>values()</code> method becomes helpful. We can declare
color associations, go over all of them and get processed CSS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">CssTemplateColor</span><span class="p">(</span><span class="k">val</span> <span class="py">mask</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="nd">@ColorRes</span> <span class="k">val</span> <span class="py">res</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Background</span><span class="p">(</span><span class="s2">&#34;color_background&#34;</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">white</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Text</span><span class="p">(</span><span class="s2">&#34;color_text&#34;</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">black</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">cssTemplate</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">    body {
</span></span></span><span class="line"><span class="cl"><span class="s">        background-color: {{color_background}};
</span></span></span><span class="line"><span class="cl"><span class="s">        color: {{color_text}};
</span></span></span><span class="line"><span class="cl"><span class="s">    }
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="py">css</span> <span class="p">=</span> <span class="nc">CssTemplateColor</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">fold</span><span class="p">(</span><span class="n">cssTemplate</span><span class="p">)</span> <span class="p">{</span> <span class="n">css</span><span class="p">,</span> <span class="n">color</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">css</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;{{</span><span class="si">${color.mask}</span><span class="s2">}}&#34;</span><span class="p">,</span> <span class="s2">&#34;#</span><span class="si">${color.res.hexRgba()}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="tests">Tests</h3>
<p>This is not as useful for JUnit-based approaches but enumerations shine with
anything specification-related.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nc">ErrorCode</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">errorCode</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">it</span><span class="p">(</span><span class="s2">&#34;creates error response from error code [</span><span class="si">${errorCode.name}</span><span class="s2">]&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertThat</span><span class="p">(</span><span class="n">api</span><span class="p">.</span><span class="n">response</span><span class="p">(</span><span class="n">errorCode</span><span class="p">)).</span><span class="n">isEqualTo</span><span class="p">(</span><span class="n">ErrorResponse</span><span class="p">(</span><span class="n">errorCode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This is a rough equivalent of this JUnit test:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Test</span> <span class="k">fun</span> <span class="nf">`it creates error response`</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">ErrorCode</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">errorCode</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertThat</span><span class="p">(</span><span class="n">api</span><span class="p">.</span><span class="n">response</span><span class="p">(</span><span class="n">errorCode</span><span class="p">)).</span><span class="n">isEqualTo</span><span class="p">(</span><span class="n">ErrorResponse</span><span class="p">(</span><span class="n">errorCode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>However, instead of a single test with a number of assertions the specification above
will produce a number of tests with a single assertion in each one.</p>
<pre tabindex="0"><code>.
├── it creates error response from error code [BadRequest]
├── it creates error response from error code [NotFound]
└── it creates error response from error code [Unauthorized]
</code></pre><h2 id="enumset"><a href="https://developer.android.com/reference/java/util/EnumSet"><code>EnumSet</code></a></h2>
<p>Use it when there is a need to define a subset of enumeration values.
It is much more efficient than regular <code>Set</code> implementations
since values are stored as bit vectors internally.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">onboardingScreens</span> <span class="p">=</span> <span class="nc">EnumSet</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="nc">Screen</span><span class="p">.</span><span class="n">SignIn</span><span class="p">,</span> <span class="nc">Screen</span><span class="p">.</span><span class="n">SignUp</span><span class="p">)</span>
</span></span></code></pre></div><p>This is a <code>java.util</code> class and unfortunately there nothing
like this in Kotlin for cases when the endgame is multiplatform.
Most likely it is possible to solve this using platform-specific declarations.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">expect</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">enumSetOf</span><span class="p">(</span><span class="k">vararg</span> <span class="n">elements</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="c1">// JVM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">actual</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">enumSetOf</span><span class="p">(</span><span class="k">vararg</span> <span class="n">elements</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">EnumSet</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Not JVM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">actual</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">enumSetOf</span><span class="p">(</span><span class="k">vararg</span> <span class="n">elements</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">setOf</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="anti-abusing-sealed-class">Anti-Abusing <code>sealed class</code></h2>
<p>I see the following <code>sealed class</code> usage from time to time and it kind of hurts.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">class</span> <span class="nc">Color</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">Red</span> <span class="p">:</span> <span class="n">Color</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">Green</span> <span class="p">:</span> <span class="n">Color</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">Blue</span> <span class="p">:</span> <span class="n">Color</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>There is no reason for this not to be an <code>enum</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Color</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Blue</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Putting semantics aside I want to remind everyone that the Kotlin <code>object</code>
creates a singleton. I doubt that it is desirable to have a lot of static objects.</p>
<p>For example, the <code>sealed class Color</code> above will be translated into something like this (in Java notation):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">Color</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Red</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Green</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Green</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Green</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Blue</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Blue</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Blue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h1 id="refactoring-irl">Refactoring IRL</h1>
<p>I was lucky to see
<a href="https://github.com/mozilla-mobile/fenix/blob/e6d29df5de88684be18778c155ba694f794423ca/app/src/main/java/org/mozilla/fenix/AppRequestInterceptor.kt#L61-L117">a convenient piece of the Mozilla Fenix code</a>
which I’m gonna refactor step-by-step.</p>
<h2 id="sealed-class--enum-class"><code>sealed class</code> → <code>enum class</code></h2>
<p>There is no need to have a <code>sealed class</code> with <code>object</code> cases. Replacing it with <code>enum</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">class</span> <span class="nc">RiskLevel</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">Low</span> <span class="p">:</span> <span class="n">RiskLevel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">Medium</span> <span class="p">:</span> <span class="n">RiskLevel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">object</span> <span class="nc">High</span> <span class="p">:</span> <span class="n">RiskLevel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>&#x2b07;&#xfe0f;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">RiskLevel</span> <span class="p">{</span> <span class="n">Low</span><span class="p">,</span> <span class="n">Medium</span><span class="p">,</span> <span class="n">High</span> <span class="p">}</span>
</span></span></code></pre></div><h2 id="methods--fields">Methods → Fields</h2>
<p>We can inline method result values into <code>enum</code> since both are matching operations and nothing else.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">getPageForRiskLevel</span><span class="p">(</span><span class="n">riskLevel</span><span class="p">:</span> <span class="n">RiskLevel</span><span class="p">):</span> <span class="n">Int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">riskLevel</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">Low</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_risk_error_pages</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">Medium</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">medium_and_high_risk_error_pages</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">High</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">medium_and_high_risk_error_pages</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">getStyleForRiskLevel</span><span class="p">(</span><span class="n">riskLevel</span><span class="p">:</span> <span class="n">RiskLevel</span><span class="p">):</span> <span class="n">Int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">riskLevel</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">Low</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_and_medium_risk_error_style</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">Medium</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_and_medium_risk_error_style</span>
</span></span><span class="line"><span class="cl">        <span class="nc">RiskLevel</span><span class="p">.</span><span class="n">High</span> <span class="o">-&gt;</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">high_risk_error_style</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>&#x2b07;&#xfe0f;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">RiskLevel</span><span class="p">(</span><span class="nd">@RawRes</span> <span class="k">val</span> <span class="py">html</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nd">@RawRes</span> <span class="k">val</span> <span class="py">css</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Low</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_risk_error_pages</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_and_medium_risk_error_style</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Medium</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">medium_and_high_risk_error_pages</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">low_and_medium_risk_error_style</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">High</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">medium_and_high_risk_error_pages</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">high_risk_error_style</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="usage-1">Usage</h2>
<p>Since we don’t have methods anymore we can reference <code>enum</code> fields directly.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">htmlResource</span> <span class="p">=</span> <span class="n">getPageForRiskLevel</span><span class="p">(</span><span class="n">riskLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="py">cssResource</span> <span class="p">=</span> <span class="n">getStyleForRiskLevel</span><span class="p">(</span><span class="n">riskLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nc">ErrorPages</span><span class="p">.</span><span class="n">createErrorPage</span><span class="p">(</span><span class="n">htmlResource</span><span class="p">,</span> <span class="n">cssResource</span><span class="p">)</span>
</span></span></code></pre></div><p>&#x2b07;&#xfe0f;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nc">ErrorPages</span><span class="p">.</span><span class="n">createErrorPage</span><span class="p">(</span><span class="n">riskLevel</span><span class="p">.</span><span class="n">html</span><span class="p">,</span> <span class="n">riskLevel</span><span class="p">.</span><span class="n">css</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="voilà">Voilà!</h2>
<p>Seems like we managed to eliminate about 20 LOC without loss.
In fact, the code became more declarative!</p>
<p>I think this example shows that there are good enumeration use cases.
Don’t be afraid to use them. Not everything needs a <code>sealed class</code>.</p>

</main>


<hr/>

<footer>
<nav>
  <ul>
    
    <li class="menu-left"><a href="/">Posts</a></li>
    
    
    <li class="menu-right"><a href="feed://arturdryomov.dev/index.xml">RSS</a></li>
    
    <li class="menu-right"><a href="https://github.com/arturdryomov">GitHub</a></li>
    
  </ul>
</nav>

</footer>


</body>

</html>

